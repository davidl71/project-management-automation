import { r } from '../../chunks/jquery-e1fc36eb.js';
import { n, b as bn, w as wm, y as yn, I as Im, C as Cm, S as Sm, E as Em } from '../../chunks/Utils-d38e56d0.js';
import { u as u$1, c } from '../../chunks/AOUnblockedList-a1d52d17.js';

var u=void 0,m=void 0,l=!1,h={},k=!0,g=[];class b{constructor(e){this.pageName=e;}hide(){r("#"+this.pageName).hide();}show(){r("#"+this.pageName).show(),this.setL10N();}setL10N(){r(".localize").each((function(s,o){var n$1=r(o).data("localize");"popup_feedback_send"==n$1&&r(o).attr("value",n.exports.i18n.getMessage(n$1)),r(o).text(n.exports.i18n.getMessage(n$1));})),r("#reportComment").attr("placeholder",n.exports.i18n.getMessage("popup_enterComments"));}}class v extends b{constructor(){super("gdprPage");}show(){super.show(),n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.gdprShowPopup}),r("#gdprAgree").on("click",(function(){Im("kHasAcceptedGDPR",!0),n.exports.runtime.sendMessage({cmd:"setGDPRForPopup"}),u.hide(),(u=h.isBlank?new b("blankPage"):new x(l)).show();})),r(".gdprItem").on("click",(s=>{let o=r(s.currentTarget);n.exports.tabs.create({url:o.attr("href")});}));}hide(){super.hide(),r("#gdprAgree").off("click"),r(".gdprItem").off("click");}}class x extends b{constructor(e){super("mainPage"),e?this.pause():h.isInUnBlockedList?this.disable():this.enable();}setPauseL10N(){var e,s;e=n.exports.i18n.getMessage("popup_protection_thispage"),s=[0],e.replace(/%[0-9]/g,(e=>s[parseInt(e.replace("%",""))])),n.exports.i18n.getMessage("popup_paused");}setDomain(){let t=h.domain;t.startsWith("www.")&&(t=t.slice(4)),r("#mainDomain").text(t);}show(){this.setDomain(),h.isInUnBlockedList&&this.setPauseL10N(),r("#pausedButton > input").on("click",(s=>{r(s.currentTarget).prop("checked")?(n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.clickPauseResume}),h.isInUnBlockedList?this.disable():this.enable(),Im("kIsPaused",!1),n.exports.runtime.sendMessage({cmd:"setPausedForPopup",paused:!1}).then((()=>{n.exports.tabs.query({currentWindow:!0,active:!0}).then((e=>{var s=e[0];void 0!==s&&n.exports.tabs.reload(s.id);}));}))):(n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.clickPause}),this.pause(),Im("kIsPaused",!0),n.exports.runtime.sendMessage({cmd:"setPausedForPopup",paused:!0}).then((()=>{n.exports.tabs.query({currentWindow:!0,active:!0}).then((e=>{var s=e[0];void 0!==s&&n.exports.tabs.reload(s.id);}));})));})),r("#resumeButtonMain").on("click",(()=>{n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.clickMainResume}),h.isInUnBlockedList?this.disable():this.enable(),Im("kIsPaused",!1),n.exports.runtime.sendMessage({cmd:"setPausedForPopup",paused:!1}).then((()=>{n.exports.tabs.query({currentWindow:!0,active:!0}).then((e=>{var s=e[0];void 0!==s&&n.exports.tabs.reload(s.id);}));}));})),r(".toggle").on("click",(s=>{let n$1=r(s.currentTarget);Cm("kUnblockedList").then((e=>{if(e&&e.length>0){let s=!0;n$1.prop("checked")?(n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.protectionEnable}),e=Sm(e,h.domain),this.enable(),s=!1,h.isInUnBlockedList=!1):(n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.protectionDisable}),e.push(h.domain),this.disable(),h.isInUnBlockedList=!0,this.showModal()),Im("kUnblockedList",e),c.updateRules(e),n.exports.runtime.sendMessage({cmd:"setUnblockedForPopup",isUnBlocked:s,site:h.domain}).then((()=>{n.exports.tabs.query({currentWindow:!0,active:!0}).then((e=>{var s=e[0];void 0!==s&&n.exports.tabs.reload(s.id);}));}));}else Im("kUnblockedList",[h.domain]),c.updateRules([h.domain]),this.disable(),this.showModal(),n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.protectionDisable}),n.exports.runtime.sendMessage({cmd:"setUnblockedForPopup",isUnBlocked:!0,site:h.domain}).then((()=>{n.exports.tabs.query({currentWindow:!0,active:!0}).then((e=>{var s=e[0];void 0!==s&&n.exports.tabs.reload(s.id);}));})),h.isInUnBlockedList=!0;}));})),super.show();}hide(){super.hide(),r(".toggle").off("click"),r("#pausedButton > input").off("click"),r("#resumeButtonMain").off("click");}pause(){r("#mainStatusInsights").addClass("wordingDisable"),r("#resumeButtonMain").show(),r(".switch").hide(),r("#pausedButton > input").prop("checked",!1),r("#mainStatusWording").text(n.exports.i18n.getMessage("popup_protection_paused")),this.setPauseL10N(),this.setDomain();}resume(){r("#pausedButton > input").prop("checked",!0),r("#resumeButtonMain").hide(),r(".switch").show(),this.setDomain();}disable(){r(".toggle").prop("checked",!1),r("#mainStatusInsights").addClass("wordingDisable"),r("#mainStatusWording").text(n.exports.i18n.getMessage("popup_protection_disabled")),this.setPauseL10N(),this.resume();}enable(){r(".toggle").prop("checked",!0),r("#mainStatusInsights").removeClass("wordingDisable"),r("#mainStatusWording").text(n.exports.i18n.getMessage("popup_protection_enabled")),this.resume();}showModal(){r("#modal").fadeIn(200),r("#modal").addClass("in"),r("#modalConfirm").on("click",(()=>{this.hideModal(),m=u,u.hide(),(u=new w).show(),n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.siteBrokenYes});})),r("#modalCancel").on("click",(()=>{this.hideModal(),n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.siteBrokenNo});}));}hideModal(){r("#modal").fadeOut(200),r("#modal").removeClass("in"),r("#modalConfirm").off("click"),r("#modalCancel").off("click");}}class w extends b{constructor(){super("reportPage"),this.status="reporting",this.checkedOption="";}show(){r(".reportPageButton").attr("value",n.exports.i18n.getMessage("popup_feedback_send")),r("#reportTable").show(),r("#reportSuccess").hide();var s=this;r("input[name=abo]").on("change",(function(){r("input[type='submit']").prop("disabled",!1),s.checkedOption=this.id,"radio7"==this.id?r("#reportComment").show():r("#reportComment").hide();})),r(".reportPageButton").on("click",(()=>{if("reporting"==this.status){r("#reportTable").hide(),r("#reportSuccess").show(),r(".reportPageButton").attr("value",n.exports.i18n.getMessage("popup_ok")),this.status="reported";let s="site:"+h.url+"\nreason: "+this.getCheckedOption();Em({comments:s,email:"n0rep1y@trendmicro.com",category:"broken site"}),n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.reportBrokenSiteSend});}else "reported"==this.status&&(n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.reportBrokenSiteOK}),this.backtoMain());})),r(".backArrow").on("click",(()=>{n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.reportBrokenSiteBack}),this.backtoMain();})),super.show();}hide(){r("#radio100").prop("checked",!0),r("input[type='submit']").prop("disabled",!0),r("#reportComment").hide(),r("input[name=abo]").off(),r(".reportPageButton").off(),r(".backArrow").off(),super.hide();}getCheckedOption(){switch(this.checkedOption){case"radio0":return "Video did not play";case"radio1":return "I can't login";case"radio2":return "Comments didn't load";case"radio3":return "Content is missing";case"radio4":return "The site asked me to disable";case"radio5":return "Image did not load";case"radio6":return "Links or buttons don't work";case"radio7":return r("#reportComment").val()}}backtoMain(){u.hide();let e=u;u=m,m=e,u.show();}}async function M(){bn.TOTAL_BLOCKED,l=bn.PAUSED_BLOCKING,g=bn.CUSTOMWHITELIST,n.exports.tabs.query({active:!0,windowId:n.exports.windows.WINDOW_ID_CURRENT}).then((e=>{let t;if(!e||!e[0])return;t=e[0],h.tabID=t.id,h.url=t.url;let o=t.url;var a=new RegExp("^https?://","i");let i=u$1(o).hostname;if(g=bn.CUSTOMWHITELIST,h.isInUnBlockedList=g&&g.length>0&&g.includes(i),h.domain=i,k){let e=!a.test(o);yn.info(o),h.isBlank=e,u=h.isBlank||""===h.url?new b("blankPage"):new x(l);}else u=new v;u.show();})),r("div[name='feedbackButton']").on("click",(()=>{n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.feedbackCLick}),setTimeout((()=>{n.exports.runtime.openOptionsPage();}),300);})),r("div[name='reportButton']").on("click",(()=>{n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.reportBrokenSiteClick}),u.hide(),m=u,(u=new w).show();}));}n.exports.runtime.onMessage.addListener((function(e,t){if("setBlockedCount"===e.cmd){if(h.tabID!==e.tabID)return;h.currentCount=e.count;}})),async function(){k=await bn.getGDPR(),n.exports.runtime.sendMessage({cmd:"trackEvent",eventName:wm.popupShow}),n.exports.runtime.connect({name:"popup"}),n.exports.runtime.sendMessage({cmd:"popupShow"}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",M):M();}();
