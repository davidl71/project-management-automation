const messageContainerId="_aig-message-container";function addButtons(e=0){const t="_aig-print-button";if(document.querySelector(`#${t}`))return;const n=[".order-status > button:last-of-type",".order-status button:last-of-type",".order-status button.comet-btn:last-of-type",".order-status .comet-btn:last-of-type",".order-status-box ~ button:last-of-type"];let r=null;for(const e of n)if(r=document.querySelector(e),r){console.log(`[AliExpress Invoice] Found button with selector: ${e}`);break}if(!r){const e=document.querySelectorAll(".order-status button.comet-btn"),t=["Receipt","Reçu","Beleg","Quittung","Recibo","Ricevuta"];for(const n of e){const e=n.textContent.trim().toLowerCase();if(t.some((t=>e.includes(t.toLowerCase())))){r=n,console.log(`[AliExpress Invoice] Found "Receipt" button by text content: ${n.textContent.trim()}`);break}}!r&&e.length>0&&(r=e[e.length-1],console.log("[AliExpress Invoice] Using last available button as fallback"))}if(!r)return e<50?void setTimeout((()=>{addButtons(e+1)}),100):(console.error("[AliExpress Invoice] Could not find target button after",50,"attempts"),void console.error("[AliExpress Invoice] Available buttons:",document.querySelectorAll(".order-status button")));try{let e=r.cloneNode(!0);e.setAttribute("id",t),e.innerHTML="Download PDF Invoice",e.addEventListener("click",storePdf),e.style.background="#ff4747",e.style.color="#ffffff",e.style.borderColor="#ff4747",r.insertAdjacentElement("afterend",e),console.log("[AliExpress Invoice] Button added successfully")}catch(e){console.error("[AliExpress Invoice] Error adding button:",e)}}async function storePdf(){clearMessages(),expendHiddenItems();let e=loadSettings(),t=await getContext();console.log(t),await downloadPdf(e,t)}function loadSettings(){let e=new Object;return chrome.storage.sync.get(["buyerExtraInfo"],(function(t){e.buyerExtraInfo=t.hasOwnProperty("buyerExtraInfo")?t.buyerExtraInfo:""})),e.buyerExtraInfo,e}addButtons(),addMessageContainer();const SEVERITY_NONE=0,SEVERITY_WARNING=1,SEVERITY_ERROR=2;function addMessageContainer(e=0){if(document.querySelector(`#${messageContainerId}`))return;let t=document.querySelector(".order-status-box");if(!t)return e<50?void setTimeout((()=>{addMessageContainer(e+1)}),100):void console.error("[AliExpress Invoice] Could not find parent for message container after",50,"attempts");try{let e=document.createElement("div");e.setAttribute("id",messageContainerId),e.style.border="1px solid #e62e04",e.style.padding="1ex",e.style.marginTop="1ex",e.style.display="none",e.innerHTML="<b>Invoice generation log</b>",t.appendChild(e),console.log("[AliExpress Invoice] Message container added successfully")}catch(e){console.error("[AliExpress Invoice] Error adding message container:",e)}}function clearMessages(){let e=document.querySelector(`#${messageContainerId}`);e&&(e.innerHTML="<b>Invoice generation log</b>",e.style.display="none")}function expendHiddenItems(){document.querySelectorAll(".comet-icon-arrowdown").forEach((function(e){e.click()}))}function recordMessage(e,t){if(2===t)console.error(e);else if(1===t)console.warn(e);else if(0===t)return void console.log(e);let n=document.querySelector(`#${messageContainerId}`);if(!n){let e=document.querySelector(".order-status-box");if(e)try{n=document.createElement("div"),n.setAttribute("id",messageContainerId),n.style.border="1px solid #e62e04",n.style.padding="1ex",n.style.marginTop="1ex",n.style.display="block",n.innerHTML="<b>Invoice generation log</b>",e.appendChild(n),console.log("[AliExpress Invoice] Message container created on demand")}catch(e){console.error("[AliExpress Invoice] Error creating message container:",e)}}n&&(n.innerHTML+=`<br/>${e}`,n.style.display="block",chrome.runtime.sendMessage({type:"alert",content:`%5B${getShipToFlag()}%7C${getCurrency()}%5D ${e}`},(e=>{console.log("alert:: "+e)})))}async function getContext(){let e=getTotal(),t=await getTax(e);return{order:{number:getOrderNumber(),date:getOrderDate()},store:{name:getStoreName(),url:getStoreUrl()},buyer:{name:getBuyerName(),street1:getBuyerStreet1(),street2:getBuyerStreet2(),zip:getBuyerZip(),city:getBuyerCity(),region:getBuyerRegion(),country:getBuyerCountry()},logistics:{shippingCompany:getShippingCompany(),trackingNumber:getTrackingNumber()},items:getItems(),shipping:getShippingTotal(),discount:getDiscount(),tax:t,total:e,subtotal:getSubTotal(),refundedItems:getRefundedItems()}}function extractTextFromElement(e,t=null){if(!e)return null;const n=e.textContent?.trim();if(n)return n;if(e.childNodes&&e.childNodes.length>0){for(let t of e.childNodes){if(t.nodeType===Node.TEXT_NODE&&t.textContent?.trim())return t.textContent.trim();if(t.nodeType===Node.ELEMENT_NODE&&t.textContent?.trim())return t.textContent.trim()}if(e.childNodes[1]&&e.childNodes[1].textContent)return e.childNodes[1].textContent.trim()}return e.innerText?e.innerText.trim():null}function parsePrice(e){if(!e)return null;let t=e.toString().trim();const n=t.match(/([\d.,]+)/);if(n){let e=n[1];return e=e.replace(/\./g,"").replace(",",".")||e.replace(",","."),e.trim()}return t}function getOrderNumber(){const e=getNthElement(document,"div.order-detail-info-content div.info-row",0,"order number",2);if(!e)return null;const t=e.querySelector('span.order-detail-gray, span[data-pl*="order_detail_gray_id"]');if(t){let e=t.nextSibling;for(;e;){if(e.nodeType===Node.TEXT_NODE){const t=e.textContent?.trim();if(t&&/\d/.test(t)){const e=t.replace(/\s*Copy\s*/i,"").trim(),n=e.match(/(\d+)/);return n?n[1]:e}}else if(e.nodeType===Node.ELEMENT_NODE){if(e.matches&&e.matches("button, .comet-btn")){e=e.nextSibling;continue}const t=e.textContent?.trim();if(t&&/\d/.test(t)){const e=t.replace(/\s*Copy\s*/i,"").trim(),n=e.match(/(\d+)/);return n?n[1]:e}}e=e.nextSibling}}const n=extractTextFromElement(e);if(n){let e=n.replace(/Order\s+ID\s*:?\s*/i,"").replace(/Order\s*:?\s*/i,"").replace(/\s*Copy\s*/i,"").trim();const t=e.match(/(\d+)/);return t?t[1]:e}return recordMessage("Could not extract order number from element",2),null}function getOrderDate(){const e=getNthElement(document,"div.order-detail-info-content div.info-row",1,"order date",2);if(!e)return null;const t=e.querySelector('span.order-detail-gray, span[data-pl*="order_detail_gray_date"]');if(t&&t.nextSibling){let e=t.nextSibling;for(;e;){if(e.nodeType===Node.TEXT_NODE){const t=e.textContent?.trim();if(t)return t}else if(e.nodeType===Node.ELEMENT_NODE){const t=e.textContent?.trim();if(t)return t}e=e.nextSibling}}const n=extractTextFromElement(e);if(n){let e=n.replace(/Order\s+placed\s+on\s*:?\s*/i,"").replace(/Order\s+date\s*:?\s*/i,"").replace(/Date\s+de\s+commande\s*:?\s*/i,"").replace(/Bestelldatum\s*:?\s*/i,"").replace(/Fecha\s+del\s+pedido\s*:?\s*/i,"").trim();if(e)return e}return recordMessage("Could not extract order date from element",2),null}function getStoreName(){return getText(document,"div.order-detail-item-store a span.store-name","store name",2)}function getStoreUrl(){const e=getAttribute(document,"div.order-detail-item-store a","href","store URL",1);if(!e)return null;try{let t=e.trim();if(t=t.replace(/^\/+/,""),t=t.split("?")[0].split("#")[0],t&&t.length>0)return t}catch(e){recordMessage(`Error parsing store URL: ${e}`,1)}return null}function getBuyerName(){const e=document.querySelector("div.order-detail-info-item div.contact-info");if(!e)return recordMessage("Could not scrape buyer name",2),null;if(e.childNodes&&e.childNodes.length>0){const t=e.childNodes[0];if(t.nodeType===Node.TEXT_NODE){const e=t.textContent?.trim();if(e)return e}}const t=e.querySelector("span.contact-info-phone");if(t&&t.previousSibling){const e=t.previousSibling;if(e.nodeType===Node.TEXT_NODE){const t=e.textContent?.trim();if(t)return t}}const n=extractTextFromElement(e);if(n){const e=[/\s*\+?\d[\d\s\+\-\(\)]{6,}/,/\s*\(\d{2,}\)/,/\s*\d{3,}[\s\-]?\d{3,}/];for(const t of e){const e=n.match(t);if(e&&e.index>0)return n.substring(0,e.index).trim()}const t=n.match(/^(.+?)(?=\s*\+|\s*\d{3,})/);return t&&t[1]?t[1].trim():n.trim()}return recordMessage("Could not extract buyer name from element",2),null}function getBuyerStreet1(){const e=getNthElement(document,"div.order-detail-info-item div",2,"buyer street line 1",2);if(!e)return null;const t=extractTextFromElement(e);return t||(recordMessage("Could not extract buyer street from element",2),null)}function getBuyerStreet2(){return null}function getBuyerCityRegionCountryZip(){const e=getNthElement(document,"div.order-detail-info-item div",3,"buyer city/region/country/zip",2);if(!e)return null;const t=extractTextFromElement(e);return t||(recordMessage("Could not extract city/region/country/zip from element",2),null)}function parseBuyerAddress(){let e=getBuyerCityRegionCountryZip().replace(/\s+/g," ").trim().split(",").map((e=>e.trim())).filter((e=>e.length>0));if(0===e.length)return recordMessage("Could not parse buyer address: empty string",2),{city:null,region:null,country:null,zip:null};let t=null,n=-1;const r=[/^\d{5}$/,/^\d{4}$/,/^\d{5}-\d{4}$/,/^[A-Z]{1,2}\d{1,2}[A-Z]?\s?\d[A-Z]{2}$/i,/^[A-Z]\d[A-Z]\s?\d[A-Z]\d$/i,/^\d{2,5}[\s-]?\d{0,3}$/],o=["country","pays","land","region","région","state","province","county"];for(let i=e.length-1;i>=0;i--){const l=e[i],u=l.toLowerCase();if(!o.some((e=>u.includes(e)))&&/\d/.test(l)){if(r.some((e=>e.test(l)))){t=l,n=i;break}if(i===e.length-1&&/^\d+[\s-]?\d*$/.test(l)){t=l,n=i;break}}}if(!t&&e.length>=2){const r=e[e.length-1];/\d/.test(r)&&!o.some((e=>r.toLowerCase().includes(e)))&&(t=r,n=e.length-1)}const i=e[0]||null;let l=null,u=null;if(4===e.length?(l=e[1],u=e[2]):3===e.length?2===n?(u=e[1],l=null):-1===n?(l=e[1],u=e[2]):(u=e[1],l=null):2===e.length?1===n?(u=null,l=null):(u=e[1],l=null):1===e.length&&(u=null,l=null),!t&&e.length>1){const r=e[e.length-1];/\d/.test(r)&&(t=r,n=e.length-1,3===e.length&&2===n&&(u=e[1],l=null))}return{city:i?i.trim():null,region:l?l.trim():null,country:u?u.trim():null,zip:t?t.trim():null}}function getBuyerCity(){const e=parseBuyerAddress();return e.city?e.city:(recordMessage("Could not scrape buyer city",2),null)}function getBuyerRegion(){return parseBuyerAddress().region}function getBuyerCountry(){const e=parseBuyerAddress();return e.country?e.country:(recordMessage("Could not scrape buyer country",1),null)}function getBuyerZip(){const e=parseBuyerAddress();return e.zip?e.zip:(recordMessage(`Could not scrape buyer zip from: ${getBuyerCityRegionCountryZip()}`,2),null)}function getShippingCompany(){return null}function getTrackingNumber(){return null}function getItems(){return forAllElements(document,"div.order-detail-item-content","items",2,((e,t)=>({title:getItemTitle(e),subtitle:getItemSubtitle(e),image:getItemImage(e),amount:getItemAmount(e),price:getItemPrice(e)})))}function getItemTitle(e){return getText(e,"div.order-detail-item-content-info div.item-title","item title",2)}function getItemSubtitle(e){return getText(e,"div.order-detail-item-content-info div.item-sku-attr","item subtitle",0)}function getItemImage(e){return getAttribute(e,"div.order-detail-item-content > a","src","item image",0)}function getItemAmount(e){const t=getText(e,"div.order-detail-item-content-info > div.item-price > span.item-price-quantity","item amount",2);if(!t)return null;const n=t.match(/(\d+)/);return n?n[1]:t.trim()}function getItemPrice(e){const t=getText(e,"div.order-detail-item-content-info div.item-price","item price",2);if(!t)return null;let n=t;if(t.includes("x")||t.includes("×")){const e=t.includes("×")?"×":"x",r=t.split(e);r.length>0&&(n=r[0].trim())}return parsePrice(n)||n.trim()}function getShippingTotal(){const e=getNthElement(document,"div.order-price-item span.right-col",1,"shipping total",2);if(!e)return"Free";const t=extractTextFromElement(e);if(!t)return"Free";const n=/\d/;return["free","gratuit","kostenlos","gratis","0","0.00","0,00"].some((e=>t.toLowerCase().includes(e.toLowerCase())))&&!n.test(t.replace(/[^\d]/g,""))||!n.test(t)?"Free":t.trim()}function getSubTotal(){const e=getNthElement(document,"div.order-price-item span.right-col",0,"subtotal",2);if(!e)return null;const t=extractTextFromElement(e);return t?t.trim():(recordMessage("Could not extract subtotal from element",2),null)}function getTotal(){const e=[".right-col.bold-font.right-gap",".right-col.bold-font",'[class*="right-col"][class*="bold"]',".order-price-item .right-col:last-child"];for(const t of e){const e=document.querySelectorAll(t);if(e&&e.length>0)for(let t of e){const e=extractTextFromElement(t);if(e&&/\d/.test(e))return e}}const t=document.getElementsByClassName("right-col bold-font right-gap");if(t&&t.length>0){const e=extractTextFromElement(t[0]);if(e)return e}return recordMessage("Could not extract total",2),null}function getOrderPriceDetails(e,t){let n=null;return e.querySelectorAll("div.order-price-item").forEach((function(e){itemName=e.getElementsByClassName("left-col")[0].textContent.trim(),itemName==t&&(n=e.getElementsByClassName("right-col")[0].textContent)})),n}function getDiscount(){const e=document.querySelectorAll("div.order-price-item");if(!e||e.length<3)return null;let t=0,n="",r=!0,o=!1;for(let i=2;i<e.length-1;i++){const e=getNthElement(document,"div.order-price-item span.right-col",i,"partial discount",0);if(!e)continue;const l=extractTextFromElement(e);if(l&&(l.includes("-")||l.includes("−"))){const e=[/-(\D*)(\d+[.,]\d{2})(\D*)/,/-(\D*)(\d+)(\D*)/,/(\d+[.,]\d{2})\s*-\s*/];let i=null;for(const t of e)if(i=l.match(t),i)break;if(i){let e=i[2]||i[1];const u=(i[1]||"")+(i[3]||"");e.includes(",")&&(r=!1,e=e.replace(",",".")),u&&!n&&(n=u.trim(),o=l.indexOf(n)<l.indexOf(e));const s=parseFloat(e);isNaN(s)||(t+=s)}}}if(0===t)return null;let i=t.toFixed(2);return r||(i=i.replace(".",",")),i=n?o?n+i:i+n:"- "+i,i}function getRefundedItems(){return forAllElements(document,"table#tp-refund-amount-table tbody tr.order-bd","refunded items",0,((e,t)=>({title:getRefundedItemTitle(e),image:getRefundedItemImage(e),total:getRefundedItemTotal(e)})))}function getRefundedItemTitle(e){return getText(e,"td.baobei div.desc","refunded item title",2)}function getRefundedItemImage(e){return getAttribute(e,"td.baobei a.pic img","src","refunded item image",0)}function getRefundedItemTotal(e){const t=getText(e,"td.refund-cash","refunded item total",2);if(!t)return null;const n=t.match(/([\d.,]+)/);if(n)return n[1].trim();const r=["Refund:","Remboursement:","Rückerstattung:","Reembolso:"];for(const e of r)if(t.toLowerCase().startsWith(e.toLowerCase()))return t.substring(e.length).trim();return t.length>4?t.substring(4).trim():t.trim()}function getShipToFlag(){try{let e=document.querySelector('[class*="ship-to--info"] span:nth-of-type(1)');if(e){return e.textContent.trim().split("/")[1]||"Unknown"}return console.error('Element with class containing "ship-to--info" and :nth-of-type(1) not found'),"Unknown"}catch(e){return console.error("Error in getShipToFlag:",e),"ERROR"}}function getCurrency(){try{let e=document.querySelector('[class*="ship-to"] :nth-of-type(2)');if(e){return e.textContent.trim()||"Unknown"}return console.error('Element with class containing "ship-to" and :nth-of-type(2) not found'),"Unknown"}catch(e){return console.error("Error in getCurrency:",e),"ERROR"}}function resolveAfter2Seconds(){return new Promise((e=>{setTimeout((()=>{e("resolved")}),2e3)}))}function getTax(e){if(document.querySelector("div.order-price span.comet-icon-help")){var t=document.querySelector("div.order-price span.comet-icon-help"),n=new MouseEvent("mouseover",{view:window,bubbles:!0,cancelable:!0});return t.dispatchEvent(n),new Promise((t=>{setTimeout((()=>{if(!document.querySelector("div.comet-popover-body div.title"))return e.match(/\d+,\d+$/)&&t(e.replace(/\d+,\d+$/,"0,00")),e.match(/\d+\.\d+$/)&&t(e.replace(/\d+\.\d+$/,"0.00")),null;{let e=getText(document,"div.comet-popover-body div.title","tax",2);t(e?e.substring(4).trim():null)}}),100)}))}{let e=document.querySelectorAll("div.order-price-item .right-col"),t=e[e.length-2];return t&&null==t.textContent.match(/-/)&&e.length>3?t.textContent:null}}function hoverTax(){var e=document.querySelector("span.comet-icon-help"),t=new MouseEvent("mouseover",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}function forAllElements(e,t,n,r,o){let i=e.querySelectorAll(t);if(!i)return recordMessage(`Could not scrape ${n}`,r),null;let l=[];for(let e=0;e<i.length;++e)l.push(o(i[e],e));return l}function getNthElement(e,t,n,r,o){let i=e.querySelectorAll(t);return!i||i.length<n+1?(recordMessage(`Could not scrape ${r}`,o),null):i[n]}function getElement(e,t,n,r){let o=e.querySelector(t);return o||(recordMessage(`Could not scrape ${n}`,r),null)}function getText(e,t,n,r){let o=getElement(e,t,n,r);return o?o.textContent.trim():null}function getAttribute(e,t,n,r,o){let i=getElement(e,t,r,o);return i?i.getAttribute(n):null}async function downloadPdf(e,t){null!=t.buyer.street2?t.buyer.street2=t.buyer.street2+"\n":t.buyer.street2="";var n=[];n.push([{text:"Article",fillColor:"#eaf2f5",border:[!1,!0,!1,!0],margin:[0,3,0,3],textTransform:"uppercase"},{text:"Amount",fillColor:"#eaf2f5",border:[!1,!0,!1,!0],margin:[0,3,0,3],textTransform:"uppercase"},{text:"Price",border:[!1,!0,!1,!0],alignment:"right",fillColor:"#eaf2f5",margin:[0,3,0,3],textTransform:"uppercase"}]),t.items.forEach((e=>n.push([{text:[e.title+"\n",{text:e.subtitle,fontSize:10,color:"#aaaaab"}],border:[!1,!1,!1,!0],margin:[0,3,0,3],alignment:"left"},{text:e.amount,border:[!1,!1,!1,!0],margin:[0,3,0,3],alignment:"right"},{border:[!1,!1,!1,!0],text:e.price,fillColor:"#f5f5f5",alignment:"right",margin:[0,3,0,3]}])));var r=[[{text:" Subtotal",border:[!1,!0,!1,!0],alignment:"right"},{border:[!1,!0,!1,!0],text:t.subtotal,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Shipping",border:[!1,!1,!1,!0],alignment:"right"},{text:t.shipping,border:[!1,!1,!1,!0],fillColor:"#f5f5f5",alignment:"right"}],[{text:"Tax / VAT",border:[!1,!1,!1,!0],alignment:"right"},{text:t.tax,border:[!1,!1,!1,!0],fillColor:"#f5f5f5",alignment:"right"}],[{text:"Total Amount",bold:!0,fontSize:14,alignment:"right",border:[!1,!1,!1,!0]},{text:t.total,bold:!0,fontSize:14,alignment:"right",border:[!1,!1,!1,!0],fillColor:"#f5f5f5"}]];t.discount&&r.splice(2,0,[{text:"Discount",border:[!1,!1,!1,!0],alignment:"right"},{text:"- "+t.discount,border:[!1,!1,!1,!0],fillColor:"#f5f5f5",alignment:"right"}]);var o={content:[{columns:[{image:await getFile("img/aliexpress.png"),width:150},[{text:"Invoice",color:"#333333",width:"*",fontSize:28,bold:!0,alignment:"right",margin:[0,0,0,15]},{stack:[{columns:[{text:"Invoice No.",color:"#aaaaab",bold:!0,width:"*",fontSize:12,alignment:"right"},{text:t.order.number,bold:!0,color:"#333333",fontSize:12,alignment:"right",width:110}]},{columns:[{text:"Date Issued",color:"#aaaaab",bold:!0,width:"*",fontSize:12,alignment:"right"},{text:t.order.date,bold:!0,color:"#333333",fontSize:12,alignment:"right",width:100}]}]}]]},{columns:[{text:"Store",color:"#aaaaab",bold:!0,fontSize:14,alignment:"left",margin:[0,20,0,5]},{text:"Buyer",color:"#aaaaab",bold:!0,fontSize:14,alignment:"right",margin:[0,20,0,5]}]},{columns:[{text:t.store.name+"\n"+t.store.url,bold:!0,color:"#333333",alignment:"left"},{text:(()=>{let n=t.buyer.name+"\n"+t.buyer.street1+"\n"+t.buyer.street2+t.buyer.zip+" "+t.buyer.city;return t.buyer.region&&t.buyer.country?n+="\n"+t.buyer.region+"\n"+t.buyer.country:t.buyer.region?n+="\n"+t.buyer.region:t.buyer.country&&(n+="\n"+t.buyer.country),e.buyerExtraInfo&&(n+="\n"+e.buyerExtraInfo),n})(),bold:!0,color:"#333333",alignment:"right"}]},"\n",{width:"100%",alignment:"left",text:"Order Details",bold:!0,margin:[0,10,0,10],fontSize:15},{layout:{defaultBorder:!1,hLineWidth:function(e,t){return 1},vLineWidth:function(e,t){return 1},hLineColor:function(e,t){return 1===e||0===e?"#bfdde8":"#eaeaea"},vLineColor:function(e,t){return"#eaeaea"},hLineStyle:function(e,t){return null},paddingLeft:function(e,t){return 10},paddingRight:function(e,t){return 10},paddingTop:function(e,t){return 2},paddingBottom:function(e,t){return 2},fillColor:function(e,t,n){return"#fff"}},table:{headerRows:1,widths:["*",45,80],body:n}},"\n","\n\n",{columns:[{},{layout:{defaultBorder:!1,hLineWidth:function(e,t){return 0},vLineWidth:function(e,t){return 0},hLineColor:function(e,t){return"#eaeaea"},vLineColor:function(e,t){return"#eaeaea"},hLineStyle:function(e,t){return null},paddingLeft:function(e,t){return 10},paddingRight:function(e,t){return 10},paddingTop:function(e,t){return 3},paddingBottom:function(e,t){return 3},fillColor:function(e,t,n){return"#fff"}},table:{headerRows:1,widths:["*","auto"],body:r}}]},"\n\n",{text:"Due to currency conversions the addition of all line items might be different from the listed total price.",style:"notesText"}],styles:{notesTitle:{fontSize:10,bold:!0,margin:[0,50,0,3]},notesText:{fontSize:10,italics:!0}},defaultStyle:{columnGap:20},info:{title:"invoice-"+getFilenameComponent(t.order.date)+"-"+getFilenameComponent(t.order.number)+".pdf"}};pdfMake.createPdf(o).download("invoice-"+getFilenameComponent(t.order.date)+"-"+getFilenameComponent(t.order.number)+".pdf")}async function getFile(e){let t=await fetch(new Request(chrome.runtime.getURL(e)));return await t.arrayBuffer()}function getFilenameComponent(e){return e?e.replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-").replace(/[^a-z0-9_-]/gi,""):""}