const __vite__fileDeps=["Root2.js","CategoryPickerMenu.js","CategoryPickerMenu.css","SyncRecoilWithAuth.js","AddTask.js","AddTask.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{dL as L,A as m,dT as _,d5 as x,dU as M,dV as I,dW as y,dY as D,dZ as j,d_ as v,d$ as F,e0 as b,e1 as R,ge as P,e2 as U,bl as W,j as r,a as T,e3 as k,e4 as C,e5 as N,e6 as O,e7 as $,e8 as B,e9 as Y,ea as G,eb as K,ec as V,ed as q,ci as Z,ee as H,ef as J}from"../../CategoryPickerMenu.js";import{A as Q}from"../../AddTask.js";window._INITIALIZE_NOW_=Date.now();window.global||(window.global=window);function l(){return{name:"IFRAME_CLOSE_REQUEST"}}class z extends L{loginWithGoogle(){throw new Error("Method not implemented.")}loginWithFacebook(){throw new Error("Method not implemented.")}redirectLoginWithFacebook(){throw new Error("Method not implemented.")}finishFacebookRedirectLogin(){throw new Error("Method not implemented.")}redirectLoginWithGoogle(){throw new Error("Method not implemented.")}finishGoogleRedirectLogin(){throw new Error("Method not implemented.")}loginWithApple(){throw new Error("Method not implemented.")}redirectLoginWithApple(){throw new Error("Method not implemented.")}}window.addEventListener("message",e=>{if(e.data==null||typeof e.data!="object"||e.data.src!==window.location.href)return;const t=e.ports[0];document.addEventListener("click",o=>{o.target!==document.body&&o.target!==h||t.postMessage(l())}),te(e.data,t).catch(o=>{console.error(o),m.captureException(o)})});m.init({app_platform:"web-extension",app_os:"browser",app_window:"browser"});const h=document.getElementById("root"),X=_(h),c=sessionStorage,ee=new x({provider:new M}),oe=({i18n:e,children:t})=>{const{userSettings:o}=Z(),a=H();return r.jsx(J,{locale:a.localeData.locale,messages:a.localeData.messages,timeFormatters:a.localeData.timeFormatters,dateFormat:o.dateFormat,timeFormat:o.timeFormat,weekStartDay:o.isoWeekStartDay,i18n:e,children:t})};async function te({extensionOrigin:e,newTask:t,authToken:o},a){const s=await I.create({detectedLocale:"en",storage:localStorage}),n=new z({abService:new y(localStorage),storage:c,i18nLocaleLoader:s});o&&await n.loginWithToken(o);const f=new D({auth:n,queryParams:new URLSearchParams,storage:c}),S=new j({locale:s.localeData.locale,messages:s.localeData.messages,timeFormatters:s.localeData.timeFormatters,dateFormat:v.MM_DD_YY,timeFormat:F.CLOCK_12,weekStartDay:b}),E=new R({auth:n,storage:c});function g(i){X.render(r.jsx(T.StrictMode,{children:r.jsx(k,{backend:C,children:r.jsx(N,{analytics:f,children:r.jsx(O,{i18nLocaleLoader:s,children:r.jsx($,{auth:n,children:r.jsx(B,{userSessionStorage:E,children:r.jsx(Y,{manager:ee,children:r.jsx(G,{children:r.jsx(K,{reducedMotion:"user",children:r.jsx(V,{children:r.jsx(oe,{i18n:S,children:r.jsx(q,{children:i})})})})})})})})})})})}))}function w(){a.postMessage(l())}function p(){window.open(new URL(`src/entrypoints/popup/index.html#newTask=${encodeURIComponent(JSON.stringify(t))}`,e)),a.postMessage(l())}function u(){return g(r.jsx(Q,{isLoading:!0,newTask:t,onIframeClose:w,onSignIn:p}))}document.documentElement.classList.remove("fade-out"),u();const[,d]=await Promise.allSettled([re(n),await P(async()=>{const{createAppRoot:i}=await import("../../Root2.js");return{createAppRoot:i}},__vite__mapDeps([0,1,2,3,4,5])).then(({createAppRoot:i})=>i({storage:c,auth:n,renderLoading:u,newTask:t,onIframeClose:w,onSignIn:p}))]);if(d.status==="rejected"){m.captureException(d.reason);return}const{Root:A}=d.value;g(r.jsx(A,{}))}async function re(e){const t=localStorage.getItem("username"),o=localStorage.getItem("password");if(t!=null&&t.length&&(o!=null&&o.length))return localStorage.removeItem("username"),localStorage.removeItem("password"),e.login(t,atob(o));e.isLoggedIn()&&e.getUserDetails()==null&&await ae(e)}async function ae(e){try{await e.refreshUserFromServer()}catch(t){if(!(e.getUserDetails()!=null&&U.isAnydoAuthError(t)&&t.code===W.NETWORK_UNAVAILABLE))return await e.logout()}}
